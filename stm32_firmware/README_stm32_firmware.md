# STM32 Firmware - Sensor Data Logger

This folder contains the STM32 firmware code for reading accelerometer data via I2C and sending it over UART to the Raspberry Pi. The data is processed further on the Pi and visualized using MQTT, Node-RED,.


---

## Target MCU

- STM32F103C8T6 (Blue Pill)
- 72 MHz ARM Cortex-M3
- Coded using STM32 Standard Peripheral Library (SPL)

---

## Included Modules

| File         | Function                                       |
|--------------|------------------------------------------------|
| 'main.c'     | Initializes I2C, UART, and reads ADXL345       |
| 'i2c.c/h'    | Handles I2C communication                      |
| 'spi.c/h'    | Initializes SPI1 (used for expansion/future)   |
| 'uart.c/h'   | Sends formatted data over UART                 |

---

## Function

- Initializes the "ADXL345 accelerometer" via I2C
- Reads X, Y, Z axes periodically
- Sends values via UART in the format:
  X: 123
  Y: -56
  Z: 89
  ------------------------

---

## I2C Setup

- Peripheral: I2C1
- Pins:
  - "PB6" → SCL
  - "PB7" → SDA
- Speed: 100 kHz
- Mode: 7-bit addressing
- Target device: **ADXL345 (I2C Address 0x53)**

### ADXL345 Configuration

| Register | Value  | Description                     |
|----------|--------|---------------------------------|
| '0x2D'   | '0x08' | Power: Measurement mode         |
| '0x31'   | '0x08' | Full resolution, ±2g            |
| '0x2C'   | '0x0A' | Bandwidth: 100 Hz               |

---

## UART Setup

- Peripheral: USART1
- Pins:
  - "PA9" → TX (to Pi RX)
  - "PA10" → RX (not used)
- Baud Rate: "9600"
- 8N1: 8 data bits, no parity, 1 stop bit

---

## Output Sample


X: 248
Y: -121
Z: 64
------------------------

This output is read by the Raspberry Pi and published to `sensor/accel` via MQTT.

---

## How to Flash

### Build firmware using STM32CubeIDE
1. Open or create a new STM32 project for STM32F103C8T6
2. Replace "main.c", "i2c.c/h", etc. with the files from this folder
3. Build the project (F7)
4. Connect via ST-Link and click "Run" (Debug)

### Flash using generated '.hex' file
Use the .hex file generated by STM32CubeIDE (found in the Debug/ folder after building):
Flash using the tools STM32CubeProgrammer or ST-Link Utility:
1.Connect your STM32 to the PC (make sure BOOT0 = 0)
2.Open the flashing tool and connect to the target
3.Select the .hex file (firmware.hex)
4.Set the start address to: 0x08000000
5.Click Program & Verify
6.Done 
---

## Future Extension Ideas

- Extend SPI interface for OLED or SD card
- Enable CAN bus or Ethernet for wider connectivity

---

## Project Structure


stm32_firmware/
├── main.c
├── i2c.c / i2c.h
├── spi.c / spi.h
├── uart.c / uart.h
└── README.md  


---

## Dependencies

- STM32 SPL (Standard Peripheral Library)
- Compiler: 'arm-none-eabi-gcc' or STM32CubeIDE

---

## Author

Khaled Hidoussi – 2024
